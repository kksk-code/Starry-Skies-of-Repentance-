<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repent</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6',
                        secondary: '#8B5CF6',
                        accent: '#EC4899',
                        dark: '#ce98ff',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        body{
            background-image: linear-gradient(to bottom,#081a28,#1b2947, #2b3152, #3b385d, #4c4067, #5d4771,#724c85);
        }
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgb(255, 247, 204);
            }
            .text-shadow-lg {
                text-shadow: 0 4px 8px rgba(154, 225, 255, 0.75), 0 2px 4px rgb(243, 172, 223);
            }
            .animate-float {
                animation: float 6s ease-in-out infinite;
            }
            .animate-pulse-slow {
                animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .backdrop-blur-xl {
                backdrop-filter: blur(20px);
            }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
    </style>
</head>
<body class="font-sans bg-dark overflow-hidden h-screen">


<!-- ä¸»å®¹å™¨ -->
<div class="relative z-10 flex flex-col items-center justify-center min-h-screen px-4 py-8">
    <!-- æ ‡é¢˜ -->
    <header class="w-full max-w-4xl mb-8 text-center">
        <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-white text-shadow-lg mb-2">The Star</h1>
        <p class="text-[clamp(1rem,2vw,1.25rem)] text-gray-300 max-w-2xl mx-auto">
            I pray to God. Donâ€™t tell me cause it hurts.â¤

        </p>
    </header>

    <!-- æ˜Ÿæ˜Ÿå®¹å™¨ -->
    <div id="star-container" class="absolute inset-0 z-10 pointer-events-none"></div>

    <!-- ç•™è¨€å‘å¸ƒè¡¨å• -->
    <div id="message-form-container" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-30 transition-all duration-300">
        <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-full p-2 shadow-xl">
            <button id="toggle-form" class="flex items-center justify-center gap-2 bg-primary hover:bg-primary/90 text-white rounded-full px-6 py-3 transition-all duration-300 transform hover:scale-105">
                <i class="fa fa-pencil"></i>
                <span>Repent to Godï¼ŒGod will forgive youğŸ˜‡</span>
            </button>
        </div>

        <div id="message-form" class="hidden mt-4 bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 shadow-xl max-w-md w-full">
            <div class="mb-4">
                <label for="message" class="block text-white text-shadow mb-2">Your repent</label>
                <textarea id="message" rows="4" class="w-full bg-white/10 border border-white/20 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary/50 resize-none" placeholder=" Repent of your sins..."></textarea>
            </div>
            <div class="flex justify-between gap-3">
                <button id="cancel-message" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white rounded-lg px-4 py-2 transition-all">
                    <i class="fa fa-times mr-1"></i>Give up on repentance.
                </button>
                <button id="submit-message" class="flex-1 bg-primary hover:bg-primary/90 text-white rounded-lg px-4 py-2 transition-all">
                    <i class="fa fa-paper-plane mr-1"></i>Post

                </button>
            </div>
        </div>
    </div>

    <!-- ç•™è¨€å¡ç‰‡ -->
    <div id="message-card" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 w-full max-w-md hidden">
        <div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl shadow-2xl overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="card-content">
            <div class="p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-white text-shadow">Content</h3>
                    <button id="close-message" class="text-white/70 hover:text-white transition-colors">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div id="message-content" class="text-white/90 text-lg mb-6 min-h-[100px]"></div>
                <div class="flex justify-between items-center text-sm text-white/60">
                    <span id="message-time">2023-01-01 12:00</span>
                    <button id="delete-message" class="hidden text-red-400 hover:text-red-300 transition-colors">
                        <i class="fa fa-trash mr-1">Let it go</i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // å­˜å‚¨æ‰€æœ‰æ˜Ÿæ˜Ÿå’Œç•™è¨€æ•°æ®
    let stars = [];
    let messages = [];

    // DOM å…ƒç´ 
    const starContainer = document.getElementById('star-container');
    const messageFormContainer = document.getElementById('message-form-container');
    const toggleFormBtn = document.getElementById('toggle-form');
    const messageForm = document.getElementById('message-form');
    const messageInput = document.getElementById('message');
    const submitMessageBtn = document.getElementById('submit-message');
    const cancelMessageBtn = document.getElementById('cancel-message');
    const messageCard = document.getElementById('message-card');
    const cardContent = document.getElementById('card-content');
    const messageContent = document.getElementById('message-content');
    const messageTime = document.getElementById('message-time');
    const closeMessageBtn = document.getElementById('close-message');
    const deleteMessageBtn = document.getElementById('delete-message');

    // åˆå§‹åŒ–é¡µé¢
    function init() {
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç•™è¨€
        loadMessages();

        // åˆ›å»ºåˆå§‹æ˜Ÿæ˜Ÿ
        createInitialStars();

        // ç»‘å®šäº‹ä»¶ç›‘å¬
        bindEvents();
    }

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ç•™è¨€
    function loadMessages() {
        const savedMessages = localStorage.getItem('starMessages');
        if (savedMessages) {
            messages = JSON.parse(savedMessages);
            messages.forEach(createStarForMessage);
        }
    }

    // åˆ›å»ºåˆå§‹æ˜Ÿæ˜Ÿï¼ˆæ²¡æœ‰å…³è”ç•™è¨€çš„è£…é¥°æ˜Ÿæ˜Ÿï¼‰
    function createInitialStars() {
        const count = window.innerWidth > 768 ? 100 : 50;
        for (let i = 0; i < count; i++) {
            createStar();
        }
    }

    // åˆ›å»ºæ˜Ÿæ˜Ÿå…ƒç´ 
    function createStar(x, y, messageId = null) {
        const star = document.createElement('div');
        const size = Math.random() * 3 + 1;
        const opacity = Math.random() * 0.8 + 0.2;
        const animationDelay = Math.random() * 5;
        const isDecorative = messageId === null;

        // è®¾ç½®ä½ç½®ï¼Œå¦‚æœæœªæä¾›åˆ™éšæœºç”Ÿæˆ
        if (x === undefined || y === undefined) {
            x = Math.random() * 100;
            y = Math.random() * 100;
        }

        // æ˜Ÿæ˜Ÿæ ·å¼
        star.className = `absolute rounded-full pointer-events-auto cursor-pointer animate-pulse-slow ${isDecorative ? 'z-20' : 'z-30'}`;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.backgroundColor = isDecorative ?
            getRandomColor(['#ffffff', '#e0e7ff', '#c7d2fe', '#a5b4fc', '#818cf8']) :
            '#b04bff'; // æœ‰ç•™è¨€çš„æ˜Ÿæ˜Ÿä½¿ç”¨æ©™è‰²
        star.style.opacity = opacity;
        star.style.left = `${x}%`;
        star.style.top = `${y}%`;
        star.style.animationDelay = `${animationDelay}s`;

        // æ·»åŠ è„‰åŠ¨æ•ˆæœ
        if (Math.random() > 0.5) {
            star.classList.add('animate-float');
            star.style.animationDuration = `${Math.random() * 4 + 4}s`;
        }

        // å¦‚æœæ˜¯æœ‰ç•™è¨€çš„æ˜Ÿæ˜Ÿï¼Œæ·»åŠ ç‚¹å‡»äº‹ä»¶
        if (!isDecorative) {
            star.dataset.messageId = messageId;
            star.addEventListener('click', () => showMessage(messageId));

            // ç¨å¾®å¤§ä¸€ç‚¹ï¼Œæ›´æ˜æ˜¾
            star.style.width = `${size + 1}px`;
            star.style.height = `${size + 1}px`;
        }

        starContainer.appendChild(star);

        // ä¿å­˜æ˜Ÿæ˜Ÿä¿¡æ¯
        if (!isDecorative) {
            stars.push({
                element: star,
                x: x,
                y: y,
                messageId: messageId
            });
        }

        return star;
    }

    // åˆ›å»ºä¸ç•™è¨€å…³è”çš„æ˜Ÿæ˜Ÿ
    function createStarForMessage(message) {
        // å¦‚æœæ²¡æœ‰ä½ç½®ä¿¡æ¯ï¼Œéšæœºç”Ÿæˆ
        if (!message.x || !message.y) {
            message.x = Math.random() * 100;
            message.y = Math.random() * 100;
            // ä¿å­˜æ›´æ–°åçš„ç•™è¨€
            saveMessages();
        }

        createStar(message.x, message.y, message.id);
    }

    // è·å–éšæœºé¢œè‰²
    function getRandomColor(colors) {
        return colors[Math.floor(Math.random() * colors.length)];
    }

    // ç»‘å®šäº‹ä»¶ç›‘å¬
    function bindEvents() {
        // åˆ‡æ¢ç•™è¨€è¡¨å•
        toggleFormBtn.addEventListener('click', toggleMessageForm);

        // æäº¤ç•™è¨€
        submitMessageBtn.addEventListener('click', submitMessage);

        // å–æ¶ˆç•™è¨€
        cancelMessageBtn.addEventListener('click', toggleMessageForm);

        // å…³é—­ç•™è¨€å¡ç‰‡
        closeMessageBtn.addEventListener('click', closeMessageCard);

        // åˆ é™¤ç•™è¨€
        deleteMessageBtn.addEventListener('click', deleteCurrentMessage);

        // ç‚¹å‡»ç©ºç™½å¤„å…³é—­ç•™è¨€å¡ç‰‡
        messageCard.addEventListener('click', (e) => {
            if (e.target === messageCard) {
                closeMessageCard();
            }
        });

        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°åˆ†å¸ƒæ˜Ÿæ˜Ÿ
        window.addEventListener('resize', redistributeStars);
    }

    // åˆ‡æ¢ç•™è¨€è¡¨å•æ˜¾ç¤º/éšè—
    function toggleMessageForm() {
        messageForm.classList.toggle('hidden');

        if (!messageForm.classList.contains('hidden')) {
            messageInput.focus();
            // è°ƒæ•´æŒ‰é’®æ–‡æœ¬
            toggleFormBtn.innerHTML = '<i class="fa fa-times"></i><span>Remove</span>';
        } else {
            // é‡ç½®è¡¨å•
            messageInput.value = '';
            // æ¢å¤æŒ‰é’®æ–‡æœ¬
            toggleFormBtn.innerHTML = '<i class="fa fa-pencil"></i><span>Repent of your sins...</span>';
        }
    }

    // æäº¤ç•™è¨€
    function submitMessage() {
        const content = messageInput.value.trim();

        if (content === '') {
            alert('I apologize, you have committed no offenses that require forgiveness.ğŸ˜¿');
            return;
        }

        if (content.length > 200) {
            alert('God will not listen to excessive nonsense... Please limit to no more than 200 words.');
            return;
        }

        // åˆ›å»ºæ–°ç•™è¨€
        const newMessage = {
            id: Date.now().toString(),
            content: content,
            timestamp: new Date().toLocaleString(),
            x: Math.random() * 80 + 10, // é¿å…è¾¹ç¼˜ä½ç½®
            y: Math.random() * 70 + 10  // é¿å…è¾¹ç¼˜ä½ç½®
        };

        // æ·»åŠ åˆ°ç•™è¨€åˆ—è¡¨
        messages.push(newMessage);

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        saveMessages();

        // åˆ›å»ºå¯¹åº”çš„æ˜Ÿæ˜Ÿ
        createStarForMessage(newMessage);

        // éšè—è¡¨å•
        toggleMessageForm();

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        showToast('Good child, God will forgive you...ğŸ¥¹');
    }

    // ä¿å­˜ç•™è¨€åˆ°æœ¬åœ°å­˜å‚¨
    function saveMessages() {
        localStorage.setItem('starMessages', JSON.stringify(messages));
    }

    // æ˜¾ç¤ºç•™è¨€å¡ç‰‡
    function showMessage(messageId) {
        const message = messages.find(m => m.id === messageId);

        if (!message) return;

        // å¡«å……ç•™è¨€å†…å®¹
        messageContent.textContent = message.content;
        messageTime.textContent = message.timestamp;

        // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰ç”¨æˆ·çš„ç•™è¨€ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦èº«ä»½éªŒè¯ï¼‰
        // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå‡è®¾æœ€è¿‘30åˆ†é’Ÿå†…çš„ç•™è¨€å¯ä»¥åˆ é™¤
        const messageDate = new Date(message.timestamp);
        const now = new Date();
        const timeDiff = (now - messageDate) / (1000 * 60); // åˆ†é’Ÿ

        if (timeDiff <= 30) {
            deleteMessageBtn.classList.remove('hidden');
            deleteMessageBtn.dataset.messageId = messageId;
        } else {
            deleteMessageBtn.classList.add('hidden');
        }

        // æ˜¾ç¤ºå¡ç‰‡
        messageCard.classList.remove('hidden');

        // æ·»åŠ åŠ¨ç”»æ•ˆæœ
        setTimeout(() => {
            cardContent.classList.remove('scale-95', 'opacity-0');
            cardContent.classList.add('scale-100', 'opacity-100');
        }, 10);
    }

    // å…³é—­ç•™è¨€å¡ç‰‡
    function closeMessageCard() {
        // æ·»åŠ å…³é—­åŠ¨ç”»
        cardContent.classList.remove('scale-100', 'opacity-100');
        cardContent.classList.add('scale-95', 'opacity-0');

        // éšè—å¡ç‰‡
        setTimeout(() => {
            messageCard.classList.add('hidden');
        }, 300);
    }

    // åˆ é™¤å½“å‰æ˜¾ç¤ºçš„ç•™è¨€
    function deleteCurrentMessage() {
        const messageId = deleteMessageBtn.dataset.messageId;

        if (!messageId) return;

        // ä»æ•°ç»„ä¸­åˆ é™¤ç•™è¨€
        messages = messages.filter(m => m.id !== messageId);

        // ä»DOMä¸­åˆ é™¤æ˜Ÿæ˜Ÿ
        const star = stars.find(s => s.messageId === messageId);
        if (star && star.element) {
            star.element.remove();
            stars = stars.filter(s => s.messageId !== messageId);
        }

        // æ›´æ–°æœ¬åœ°å­˜å‚¨
        saveMessages();

        // å…³é—­å¡ç‰‡
        closeMessageCard();

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        showToast('You have been forgiven!!ğŸ˜‡');
    }

    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-dark/80 text-white px-6 py-3 rounded-full shadow-lg z-50 transition-all duration-300 opacity-0';
        toast.textContent = message;

        document.body.appendChild(toast);

        // æ˜¾ç¤ºåŠ¨ç”»
        setTimeout(() => {
            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');
        }, 10);

        // è‡ªåŠ¨éšè—
        setTimeout(() => {
            toast.classList.remove('opacity-100');
            toast.classList.add('opacity-0');

            setTimeout(() => {
                document.body.removeChild(toast);
            }, 300);
        }, 3000);
    }

    // é‡æ–°åˆ†å¸ƒæ˜Ÿæ˜Ÿï¼ˆçª—å£å¤§å°å˜åŒ–æ—¶ï¼‰
    function redistributeStars() {
        // ç§»é™¤æ‰€æœ‰è£…é¥°æ€§æ˜Ÿæ˜Ÿ
        const decorativeStars = starContainer.querySelectorAll('.z-20');
        decorativeStars.forEach(star => star.remove());


        createInitialStars();
    }

    // åˆå§‹åŒ–åº”ç”¨
    document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
